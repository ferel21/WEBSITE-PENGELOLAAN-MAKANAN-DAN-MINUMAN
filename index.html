<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Manajemen Pengolahan Makanan & Minuman</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- Google Font Import --- */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        /* --- CSS Variables for Theming --- */
        :root {
            --primary-color: #4a90e2;
            --primary-hover: #357abd;
            --success-color: #50e3c2;
            --success-hover: #38a88f;
            --warning-color: #f5a623;
            --warning-hover: #c4851c;
            --danger-color: #d0021b;
            --danger-hover: #a10215;
            --info-color: #4a4a4a;

            --bg-color: #f4f7fc;
            --sidebar-bg: #ffffff;
            --card-bg: #ffffff;
            --header-bg: #ffffff;
            --text-color: #4a4a4a;
            --text-light: #9b9b9b;
            --border-color: #e8e8e8;

            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --border-radius: 12px;
            --transition-speed: 0.3s;
        }

        /* --- Global & Reset Styles --- */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 14px;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* --- Main Layout --- */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 260px;
            background-color: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: width var(--transition-speed) ease;
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            z-index: 1000;
        }

        .main-content {
            flex-grow: 1;
            padding: 24px;
            margin-left: 260px;
            transition: margin-left var(--transition-speed) ease;
        }

        /* Sidebar Collapsed State */
        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar.collapsed .sidebar-header .logo span,
        .sidebar.collapsed .nav-menu .nav-link span {
            display: none;
        }

        .sidebar.collapsed .sidebar-header .logo {
            justify-content: center;
        }

        .sidebar.collapsed .nav-menu .nav-link {
            justify-content: center;
        }

        .main-content.full-width {
            margin-left: 80px;
        }


        /* --- Sidebar --- */
        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .sidebar-toggle {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-light);
        }

        .nav-menu {
            list-style: none;
            padding: 20px 10px;
            flex-grow: 1;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            color: var(--text-light);
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 5px;
            font-weight: 500;
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        .nav-link i {
            font-size: 18px;
            width: 20px;
            text-align: center;
        }

        .nav-link:hover {
            background-color: #f0f5ff;
            color: var(--primary-color);
        }

        .nav-item.active .nav-link {
            background-color: var(--primary-color);
            color: #fff;
        }


        /* --- Header --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--header-bg);
            padding: 15px 24px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        #page-title {
            font-size: 24px;
            font-weight: 600;
            margin: 0;
        }

        #page-subtitle {
            color: var(--text-light);
            font-size: 14px;
            margin: 0;
        }
        
        .header-right {
           display: none; /* Hide the right side of the header */
        }


        /* --- Section --- */
        .section {
            display: none;
        }
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        /* --- General Components --- */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform var(--transition-speed);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-primary { background-color: var(--primary-color); color: #fff; }
        .btn-primary:hover { background-color: var(--primary-hover); }

        .btn-success { background-color: var(--success-color); color: #fff; }
        .btn-success:hover { background-color: var(--success-hover); }

        .btn-warning { background-color: var(--warning-color); color: #fff; }
        .btn-warning:hover { background-color: var(--warning-hover); }

        .btn-danger { background-color: var(--danger-color); color: #fff; }
        .btn-danger:hover { background-color: var(--danger-hover); }

        .btn-secondary { background-color: #e9ecef; color: var(--text-color); }
        .btn-secondary:hover { background-color: #d1d5db; }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* --- Dashboard --- */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .stat-card {
            background-color: var(--card-bg);
            padding: 24px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 20px;
            border-left: 5px solid;
        }

        .stat-card.primary { border-color: var(--primary-color); }
        .stat-card.success { border-color: var(--success-color); }
        .stat-card.warning { border-color: var(--warning-color); }
        .stat-card.danger { border-color: var(--danger-color); }

        .stat-icon {
            font-size: 32px;
            padding: 15px;
            border-radius: 50%;
            color: #fff;
        }
        .stat-card.primary .stat-icon { background-color: var(--primary-color); }
        .stat-card.success .stat-icon { background-color: var(--success-color); }
        .stat-card.warning .stat-icon { background-color: var(--warning-color); }
        .stat-card.danger .stat-icon { background-color: var(--danger-color); }


        .stat-content h3 {
            font-size: 28px;
            font-weight: 700;
            margin: 0;
        }

        .stat-content p {
            color: var(--text-light);
            margin: 0;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .dashboard-card {
            background-color: var(--card-bg);
            padding: 24px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .dashboard-card h3 {
            margin-top: 0;
            margin-bottom: 20px;
        }

        .activity-item, .reminder-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }
        .activity-list :last-child, .reminder-list :last-child {
            border-bottom: none;
        }

        .activity-item small {
            margin-left: auto;
            color: var(--text-light);
        }
        .text-success { color: var(--success-color); }
        .text-warning { color: var(--warning-color); }
        .text-danger { color: var(--danger-color); }
        .text-info { color: var(--primary-color); }


        /* --- Guidelines Section --- */
        .guidelines-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
        }
        .guideline-card {
            background-color: #fff;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        .guideline-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background-color: var(--primary-color);
            color: #fff;
        }
        .guideline-header i { font-size: 24px; }
        .guideline-header h3 { margin: 0; font-size: 18px; }
        .guideline-content { padding: 20px; }
        .guideline-content ul { list-style: none; margin-bottom: 20px; padding-left: 0; }
        .guideline-content ul li { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 8px; }
        .guideline-content ul li i { color: var(--success-color); margin-top: 4px; }
        .checklist-section, .storage-guide, .cooking-temp-guide { margin-top: 20px; }
        .checklist-grid, .temp-guide-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .temp-requirement { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid var(--border-color); }
        .temp-requirement:last-child { border: none; }
        .temp-value { font-weight: 600; color: var(--danger-color); }


        /* --- Ingredients/Recipes Grid --- */
        .filters-container {
            display: flex;
            gap: 15px;
            margin-bottom: 24px;
            align-items: center;
        }
        .search-box { position: relative; }
        .search-box input {
            padding: 10px 15px 10px 40px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            width: 250px;
        }
        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }
        .filter-select {
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: #fff;
        }

        .ingredients-grid, .recipes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }
        /* Card styles for ingredients and recipes will be added by JS */
        .ingredient-card, .recipe-card {
            background-color: #fff;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .recipe-card-image {
            height: 150px;
            background-size: cover;
            background-position: center;
        }
        .ingredient-card-header, .recipe-card-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        .ingredient-card-header h4, .recipe-card-header h4 {
            margin: 0;
            font-size: 16px;
        }
        .ingredient-card-body, .recipe-card-body {
            padding: 15px;
            flex-grow: 1;
        }
        .recipe-card-body p { margin-top: 0; }
        .ingredient-info, .recipe-info {
            font-size: 13px;
            color: var(--text-light);
        }
        .ingredient-info strong, .recipe-info strong {
            color: var(--text-color);
        }
        .ingredient-card-footer, .recipe-card-footer {
            padding: 15px;
            background-color: #fafafa;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* --- Inventory Table --- */
        .inventory-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }
        .summary-card {
            background: #fff;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        .summary-card h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--text-light);
            font-weight: 500;
        }
        .summary-value {
            font-size: 24px;
            font-weight: 700;
        }
        .summary-value.warning { color: var(--warning-color); }
        .summary-value.danger { color: var(--danger-color); }

        .inventory-table-container {
            background: #fff;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow-x: auto;
        }
        .inventory-table {
            width: 100%;
            border-collapse: collapse;
        }
        .inventory-table th, .inventory-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        .inventory-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        .inventory-table tbody tr:hover {
            background-color: #f4f7fc;
        }
        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            color: #fff;
        }
        .status-good { background-color: var(--success-color); }
        .status-low { background-color: var(--warning-color); }
        .status-expiring { background-color: var(--danger-color); }


        /* --- Modals --- */
        .modal {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 24px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            animation: slideIn 0.3s ease-out;
        }
        .modal-content.large {
            max-width: 900px;
        }
        @keyframes slideIn {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover, .close:focus {
            color: black;
        }
        .modal-form .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .modal-form .form-group.full-width {
            grid-column: 1 / -1;
        }
        .modal-form .form-group {
            display: flex;
            flex-direction: column;
        }
        .modal-form label {
            margin-bottom: 8px;
            font-weight: 600;
        }
        .modal-form input, .modal-form select, .modal-form textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
        }
        .modal-form textarea {
            resize: vertical;
        }
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 24px;
        }
        .recipe-ingredients-section {
            grid-column: 1 / -1;
            margin-top: 10px;
        }
        .ingredient-row {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        .ingredient-row select {
            flex-grow: 1;
        }
        .ingredient-row input {
            width: 120px;
        }

        /* --- Reports & Charts --- */
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }
        .report-card {
            background-color: #fff;
            padding: 24px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        .report-tabs {
            margin-bottom: 20px;
        }
        .tab-btn {
            padding: 10px 20px;
            border: none;
            background-color: transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: var(--text-light);
            border-bottom: 2px solid transparent;
        }
        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        .report-tab-content {
            display: none;
        }
        .report-tab-content.active {
            display: block;
        }
        .report-table {
            width: 100%;
            border-collapse: collapse;
        }
        .report-table th, .report-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            text-align: left;
        }
        .report-table th { background-color: #f8f9fa; }


        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
        .toast {
            background-color: #333;
            color: #fff;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateX(100%);
        }
        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }
        .toast.success { background-color: var(--success-color); }
        .toast.error { background-color: var(--danger-color); }
        .toast.info { background-color: var(--primary-color); }


        /* Responsive Design */
        @media (max-width: 992px) {
            .sidebar {
                width: 80px;
            }
            .main-content {
                margin-left: 80px;
            }
            .sidebar .sidebar-header .logo span,
            .sidebar .nav-menu .nav-link span {
                display: none;
            }
            .sidebar .sidebar-header .logo, .sidebar .nav-menu .nav-link {
                justify-content: center;
            }
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            .filters-container {
                flex-direction: column;
                align-items: stretch;
            }
            .search-box input {
                width: 100%;
            }
            .modal-form .form-grid {
                grid-template-columns: 1fr;
            }
            .reports-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-utensils"></i>
                    <span>FoodBev Pro</span>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item active">
                    <a href="#" class="nav-link" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="guidelines">
                        <i class="fas fa-book-open"></i>
                        <span>Panduan Pengolahan</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="ingredients">
                        <i class="fas fa-seedling"></i>
                        <span>Manajemen Bahan</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="recipes">
                        <i class="fas fa-clipboard-list"></i>
                        <span>Resep & Menu</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="processing">
                        <i class="fas fa-fire-burner"></i>
                        <span>Proses Pengolahan</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="inventory">
                        <i class="fas fa-boxes"></i>
                        <span>Inventori</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="quality">
                        <i class="fas fa-shield-alt"></i>
                        <span>Kontrol Kualitas</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="waste">
                        <i class="fas fa-recycle"></i>
                        <span>Pengelolaan Limbah</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="reports">
                        <i class="fas fa-chart-bar"></i>
                        <span>Laporan & Analisis</span>
                    </a>
                </li>
            </ul>
        </nav>

        <main class="main-content">
            <header class="header">
                <div class="header-left">
                    <h1 id="page-title">Dashboard</h1>
                    <p id="page-subtitle">Sistem Manajemen Pengolahan Makanan & Minuman</p>
                </div>
                 <div class="header-right">
                    <!-- This section is now hidden via CSS -->
                </div>
            </header>

            <section id="dashboard" class="section active">
                <div class="stats-grid">
                    <div class="stat-card primary">
                        <div class="stat-icon">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalRecipes">0</h3>
                            <p>Total Resep</p>
                        </div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-icon">
                            <i class="fas fa-seedling"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalIngredients">0</h3>
                            <p>Bahan Tersedia</p>
                        </div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="lowStockItems">0</h3>
                            <p>Stok Rendah</p>
                        </div>
                    </div>
                    <div class="stat-card danger">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="expiringItems">0</h3>
                            <p>Akan Kedaluwarsa</p>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3>Aktivitas Terbaru</h3>
                        <div class="activity-list" id="activityList">
                           <!-- Dynamically populated -->
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h3>Pengingat Kualitas</h3>
                        <div class="reminder-list" id="qualityReminders">
                            <div class="reminder-item">
                                <i class="fas fa-thermometer-half text-danger"></i>
                                <span>Periksa suhu freezer setiap 2 jam</span>
                            </div>
                            <div class="reminder-item">
                                <i class="fas fa-hands-wash text-info"></i>
                                <span>Cuci tangan sebelum mengolah makanan</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="guidelines" class="section">
                <!-- Guidelines content remains the same -->
                 <div class="guidelines-container">
                    <div class="guideline-card">
                        <div class="guideline-header">
                            <i class="fas fa-shopping-basket"></i>
                            <h3>1. Pemilihan Bahan</h3>
                        </div>
                        <div class="guideline-content">
                            <ul>
                                <li><i class="fas fa-check"></i> Pilih bahan makanan segar, tidak busuk, tidak berbau</li>
                                <li><i class="fas fa-check"></i> Cek tanggal kedaluwarsa pada makanan kemasan</li>
                                <li><i class="fas fa-check"></i> Gunakan air bersih dan layak minum</li>
                                <li><i class="fas fa-check"></i> Periksa kualitas visual dan tekstur bahan</li>
                            </ul>
                        </div>
                    </div>
                    <div class="guideline-card">
                        <div class="guideline-header">
                            <i class="fas fa-box"></i>
                            <h3>2. Penyimpanan Bahan</h3>
                        </div>
                        <div class="guideline-content">
                            <ul>
                                <li><i class="fas fa-check"></i> Simpan bahan segar (daging, ikan, sayuran) di kulkas/freezer</li>
                                <li><i class="fas fa-check"></i> Pisahkan bahan mentah dan matang</li>
                                <li><i class="fas fa-check"></i> Gunakan wadah tertutup yang bersih dan aman</li>
                                <li><i class="fas fa-check"></i> Label tanggal penyimpanan</li>
                            </ul>
                        </div>
                    </div>
                    <div class="guideline-card">
                        <div class="guideline-header">
                            <i class="fas fa-fire-burner"></i>
                            <h3>3. Pengolahan Makanan</h3>
                        </div>
                        <div class="guideline-content">
                             <ul>
                                <li><i class="fas fa-check"></i> Cuci tangan dengan sabun sebelum dan sesudah mengolah</li>
                                <li><i class="fas fa-check"></i> Gunakan peralatan masak yang bersih</li>
                                <li><i class="fas fa-check"></i> Masak hingga matang sempurna (minimal 75°C untuk daging)</li>
                                <li><i class="fas fa-check"></i> Hindari menggunakan minyak berulang kali</li>
                            </ul>
                        </div>
                    </div>
                     <div class="guideline-card">
                        <div class="guideline-header">
                            <i class="fas fa-glass-water"></i>
                            <h3>4. Pengolahan Minuman</h3>
                        </div>
                        <div class="guideline-content">
                            <ul>
                                <li><i class="fas fa-check"></i> Gunakan air matang atau tersaring</li>
                                <li><i class="fas fa-check"></i> Simpan dalam wadah tertutup</li>
                                <li><i class="fas fa-check"></i> Hindari es dari air tidak higienis</li>
                                <li><i class="fas fa-check"></i> Pastikan wadah dan bahan bersih untuk minuman tradisional</li>
                            </ul>
                        </div>
                    </div>

                    <div class="guideline-card">
                        <div class="guideline-header">
                            <i class="fas fa-concierge-bell"></i>
                            <h3>5. Penyajian</h3>
                        </div>
                        <div class="guideline-content">
                            <ul>
                                <li><i class="fas fa-check"></i> Gunakan wadah bersih untuk penyajian</li>
                                <li><i class="fas fa-check"></i> Tutup makanan agar tidak dihinggapi lalat</li>
                                <li><i class="fas fa-check"></i> Konsumsi sesuai waktu (hindari terlalu lama di suhu ruang)</li>
                                <li><i class="fas fa-check"></i> Jaga suhu makanan panas tetap panas, dingin tetap dingin</li>
                            </ul>
                        </div>
                    </div>

                    <div class="guideline-card">
                        <div class="guideline-header">
                            <i class="fas fa-recycle"></i>
                            <h3>6. Pengelolaan Sisa</h3>
                        </div>
                        <div class="guideline-content">
                            <ul>
                                <li><i class="fas fa-check"></i> Sisa organik bisa dijadikan kompos</li>
                                <li><i class="fas fa-check"></i> Sisa minyak jangan dibuang ke saluran air</li>
                                <li><i class="fas fa-check"></i> Kurangi pemborosan dengan memasak secukupnya</li>
                                <li><i class="fas fa-check"></i> Daur ulang kemasan yang masih bisa digunakan</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <section id="ingredients" class="section">
                <div class="section-header">
                    <h2>Manajemen Bahan</h2>
                    <button class="btn btn-primary" onclick="openIngredientModal()">
                        <i class="fas fa-plus"></i> Tambah Bahan
                    </button>
                </div>

                <div class="filters-container">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="ingredientSearch" placeholder="Cari bahan...">
                    </div>
                    <select id="categoryFilter" class="filter-select">
                        <option value="">Semua Kategori</option>
                        <option value="protein">Protein</option>
                        <option value="karbohidrat">Karbohidrat</option>
                        <option value="sayuran">Sayuran</option>
                        <option value="buah">Buah</option>
                        <option value="rempah">Rempah</option>
                        <option value="dairy">Dairy</option>
                        <option value="minuman">Bahan Minuman</option>
                    </select>
                    <select id="storageFilter" class="filter-select">
                        <option value="">Semua Penyimpanan</option>
                        <option value="freezer">Freezer</option>
                        <option value="chiller">Chiller</option>
                        <option value="suhu-ruang">Suhu Ruang</option>
                        <option value="kering">Tempat Kering</option>
                    </select>
                </div>

                <div class="ingredients-grid" id="ingredientsGrid">
                    <!-- Dynamically populated -->
                </div>
            </section>

            <section id="recipes" class="section">
                <div class="section-header">
                    <h2>Resep & Menu</h2>
                    <button class="btn btn-primary" onclick="openRecipeModal()">
                        <i class="fas fa-plus"></i> Tambah Resep
                    </button>
                </div>

                <div class="recipes-container">
                    <div class="recipes-grid" id="recipesGrid">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </section>

            <section id="processing" class="section">
                <div class="section-header">
                    <h2>Proses Pengolahan</h2>
                    <button class="btn btn-success" onclick="openProcessingModal()">
                        <i class="fas fa-play"></i> Mulai Pengolahan
                    </button>
                </div>

                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3>Antrian Pengolahan</h3>
                        <div class="queue-list" id="queueList">
                           <!-- Dynamically populated -->
                        </div>
                    </div>
                     <div class="dashboard-card">
                        <h3>Langkah Pengolahan Aktif</h3>
                        <div class="steps-container" id="stepsContainer">
                            <p>Pilih item dari antrian untuk melihat langkah-langkahnya.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="inventory" class="section">
                <div class="section-header">
                    <h2>Inventori</h2>
                    <div class="header-actions">
                        <button class="btn btn-success" onclick="exportInventory()">
                            <i class="fas fa-download"></i> Export
                        </button>
                        <button class="btn btn-warning" onclick="checkExpiry()">
                            <i class="fas fa-clock"></i> Cek Kedaluwarsa
                        </button>
                    </div>
                </div>

                <div class="inventory-summary">
                    <div class="summary-card">
                        <h4>Total Nilai Inventori</h4>
                        <span class="summary-value" id="totalInventoryValue">Rp 0</span>
                    </div>
                    <div class="summary-card">
                        <h4>Item Akan Kedaluwarsa</h4>
                        <span class="summary-value warning" id="expiringCount">0</span>
                    </div>
                    <div class="summary-card">
                        <h4>Stok Rendah</h4>
                        <span class="summary-value danger" id="lowStockCount">0</span>
                    </div>
                </div>

                <div class="inventory-table-container">
                    <table class="inventory-table" id="inventoryTable">
                        <thead>
                            <tr>
                                <th>Nama Bahan</th>
                                <th>Kategori</th>
                                <th>Stok</th>
                                <th>Satuan</th>
                                <th>Harga Satuan</th>
                                <th>Total Nilai</th>
                                <th>Tanggal Kedaluwarsa</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTableBody">
                            <!-- Dynamically populated -->
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="quality" class="section">
                <div class="section-header">
                    <h2>Kontrol Kualitas</h2>
                    <button class="btn btn-primary" onclick="startQualityCheck()">
                        <i class="fas fa-clipboard-check"></i> Mulai Pemeriksaan
                    </button>
                </div>

                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3>Checklist Harian</h3>
                        <div class="checklist-container" id="qualityChecklist">
                            <p>Klik "Mulai Pemeriksaan" untuk memuat checklist.</p>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <h3>Peringatan Kualitas</h3>
                        <div class="alerts-container" id="qualityAlerts">
                             <p>Tidak ada peringatan saat ini.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="waste" class="section">
                <div class="section-header">
                    <h2>Pengelolaan Limbah</h2>
                    <button class="btn btn-success" onclick="openWasteModal()">
                        <i class="fas fa-plus"></i> Catat Limbah
                    </button>
                </div>

                 <div class="stats-grid">
                    <div class="stat-card success">
                         <div class="stat-icon"><i class="fas fa-leaf"></i></div>
                        <div class="stat-content">
                            <h3 id="organicWaste">0 kg</h3>
                            <p>Limbah Organik</p>
                        </div>
                    </div>
                     <div class="stat-card warning">
                        <div class="stat-icon"><i class="fas fa-oil-can"></i></div>
                        <div class="stat-content">
                            <h3 id="usedOil">0 liter</h3>
                            <p>Minyak Bekas</p>
                        </div>
                    </div>
                    <div class="stat-card primary">
                        <div class="stat-icon"><i class="fas fa-box"></i></div>
                        <div class="stat-content">
                            <h3 id="packagingWaste">0 kg</h3>
                            <p>Kemasan</p>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                     <h3>Pelacakan Limbah Mingguan</h3>
                     <div class="waste-chart-container" style="height: 300px;">
                        <canvas id="wasteChart"></canvas>
                    </div>
                </div>
            </section>

            <section id="reports" class="section">
                <div class="section-header">
                    <h2>Laporan & Analisis</h2>
                    <div class="report-controls">
                        <select id="reportPeriod" class="filter-select">
                            <option value="daily">Harian</option>
                            <option value="weekly">Mingguan</option>
                            <option value="monthly">Bulanan</option>
                        </select>
                        <button class="btn btn-primary" onclick="generateReport()">
                            <i class="fas fa-file-alt"></i> Generate Laporan
                        </button>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>Laporan Detail</h3>
                    <div class="report-tabs">
                        <button class="tab-btn active" data-tab="inventory-report">Inventori</button>
                        <button class="tab-btn" data-tab="production-report">Produksi</button>
                        <button class="tab-btn" data-tab="waste-report">Limbah</button>
                    </div>
                    
                    <div class="report-content-container">
                        <div id="inventory-report" class="report-tab-content active">
                            <p>Klik "Generate Laporan" untuk melihat data.</p>
                        </div>
                        
                        <div id="production-report" class="report-tab-content">
                            <p>Klik "Generate Laporan" untuk melihat data.</p>
                        </div>
                        
                        <div id="waste-report" class="report-tab-content">
                             <p>Klik "Generate Laporan" untuk melihat data.</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <div id="ingredientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="ingredientModalTitle">Tambah Bahan Baru</h3>
                <span class="close" onclick="closeModal('ingredientModal')">&times;</span>
            </div>
            <form id="ingredientForm" class="modal-form">
                <input type="hidden" id="ingredientId">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="ingredientName">Nama Bahan*</label>
                        <input type="text" id="ingredientName" required placeholder="Contoh: Beras Premium">
                    </div>
                    <div class="form-group">
                        <label for="ingredientCategory">Kategori*</label>
                        <select id="ingredientCategory" required>
                            <option value="">Pilih Kategori</option>
                            <option value="protein">Protein</option>
                            <option value="karbohidrat">Karbohidrat</option>
                            <option value="sayuran">Sayuran</option>
                            <option value="buah">Buah</option>
                            <option value="rempah">Rempah</option>
                            <option value="dairy">Dairy</option>
                            <option value="minuman">Bahan Minuman</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ingredientStock">Stok*</label>
                        <input type="number" id="ingredientStock" required min="0" step="0.1" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="ingredientUnit">Satuan*</label>
                        <select id="ingredientUnit" required>
                            <option value="">Pilih Satuan</option>
                            <option value="kg">Kilogram (kg)</option>
                            <option value="gram">Gram (g)</option>
                            <option value="liter">Liter (L)</option>
                            <option value="ml">Mililiter (ml)</option>
                            <option value="pcs">Pieces (pcs)</option>
                            <option value="pack">Pack</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ingredientPrice">Harga per Satuan*</label>
                        <input type="number" id="ingredientPrice" required min="0" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="ingredientMinStock">Stok Minimum*</label>
                        <input type="number" id="ingredientMinStock" required min="0" step="0.1" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="ingredientStorage">Penyimpanan*</label>
                        <select id="ingredientStorage" required>
                            <option value="">Pilih Penyimpanan</option>
                            <option value="freezer">Freezer (-18°C)</option>
                            <option value="chiller">Chiller (0-4°C)</option>
                            <option value="suhu-ruang">Suhu Ruang</option>
                            <option value="kering">Tempat Kering</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ingredientExpiry">Tanggal Kedaluwarsa</label>
                        <input type="date" id="ingredientExpiry">
                    </div>
                </div>
                <div class="form-group full-width">
                    <label for="ingredientNotes">Catatan</label>
                    <textarea id="ingredientNotes" placeholder="Catatan tambahan tentang bahan ini..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('ingredientModal')">Batal</button>
                    <button type="submit" class="btn btn-primary">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <div id="recipeModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="recipeModalTitle">Tambah Resep Baru</h3>
                <span class="close" onclick="closeModal('recipeModal')">&times;</span>
            </div>
            <form id="recipeForm" class="modal-form">
                <input type="hidden" id="recipeId">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="recipeName">Nama Resep*</label>
                        <input type="text" id="recipeName" required placeholder="Contoh: Nasi Goreng Spesial">
                    </div>
                    <div class="form-group">
                        <label for="recipeCategory">Kategori*</label>
                        <select id="recipeCategory" required>
                            <option value="">Pilih Kategori</option>
                            <option value="makanan-utama">Makanan Utama</option>
                            <option value="appetizer">Appetizer</option>
                            <option value="dessert">Dessert</option>
                            <option value="minuman">Minuman</option>
                            <option value="snack">Snack</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="recipeServings">Porsi*</label>
                        <input type="number" id="recipeServings" required min="1" placeholder="1">
                    </div>
                    <div class="form-group">
                        <label for="recipeCookTime">Waktu Masak (menit)*</label>
                        <input type="number" id="recipeCookTime" required min="1" placeholder="30">
                    </div>
                    <div class="form-group">
                        <label for="recipeDifficulty">Tingkat Kesulitan*</label>
                        <select id="recipeDifficulty" required>
                            <option value="">Pilih Tingkat</option>
                            <option value="mudah">Mudah</option>
                            <option value="sedang">Sedang</option>
                            <option value="sulit">Sulit</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="recipePrice">Harga Jual*</label>
                        <input type="number" id="recipePrice" required min="0" placeholder="0">
                    </div>
                </div>
                
                <div class="recipe-ingredients-section">
                    <h4>Bahan-bahan</h4>
                    <div id="recipeIngredients">
                        <div class="ingredient-row">
                            <select class="ingredient-select" name="ingredientId[]" required>
                                <option value="">Pilih Bahan</option>
                            </select>
                            <input type="number" name="ingredientAmount[]" placeholder="Jumlah" min="0" step="0.1" required>
                            <button type="button" class="btn btn-sm btn-danger" onclick="removeIngredientRow(this)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-sm btn-success" onclick="addIngredientRow()">
                        <i class="fas fa-plus"></i> Tambah Bahan
                    </button>
                </div>

                <div class="form-group full-width">
                    <label for="recipeInstructions">Langkah-langkah Pembuatan*</label>
                    <textarea id="recipeInstructions" required rows="6" placeholder="1. Siapkan bahan-bahan&#10;2. Panaskan minyak..."></textarea>
                </div>

                <div class="form-group full-width">
                    <label for="recipeNotes">Catatan</label>
                    <textarea id="recipeNotes" rows="3" placeholder="Tips dan catatan khusus..."></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('recipeModal')">Batal</button>
                    <button type="submit" class="btn btn-primary">Simpan Resep</button>
                </div>
            </form>
        </div>
    </div>

    <div id="processingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Mulai Pengolahan</h3>
                <span class="close" onclick="closeModal('processingModal')">&times;</span>
            </div>
            <form id="processingForm" class="modal-form">
                <div class="form-group">
                    <label for="processRecipe">Pilih Resep*</label>
                    <select id="processRecipe" required>
                        <option value="">Pilih Resep</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="processQuantity">Jumlah Porsi*</label>
                    <input type="number" id="processQuantity" required min="1" value="1">
                </div>
                <div class="form-group">
                    <label for="processChef">Chef/Penanggung Jawab*</label>
                    <input type="text" id="processChef" required placeholder="Nama chef">
                </div>
                <div class="form-group full-width">
                    <label for="processNotes">Catatan Khusus</label>
                    <textarea id="processNotes" placeholder="Catatan atau instruksi khusus..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('processingModal')">Batal</button>
                    <button type="submit" class="btn btn-success">Mulai Pengolahan</button>
                </div>
            </form>
        </div>
    </div>

    <div id="wasteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Catat Limbah</h3>
                <span class="close" onclick="closeModal('wasteModal')">&times;</span>
            </div>
            <form id="wasteForm" class="modal-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="wasteType">Jenis Limbah*</label>
                        <select id="wasteType" required>
                            <option value="">Pilih Jenis</option>
                            <option value="organik">Organik</option>
                            <option value="minyak">Minyak Bekas</option>
                            <option value="kemasan">Kemasan</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="wasteAmount">Jumlah*</label>
                        <input type="number" id="wasteAmount" required min="0" step="0.1" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="wasteUnit">Satuan*</label>
                        <select id="wasteUnit" required>
                            <option value="">Pilih Satuan</option>
                            <option value="kg">Kilogram</option>
                            <option value="liter">Liter</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="wasteSource">Sumber*</label>
                        <input type="text" id="wasteSource" required placeholder="Contoh: Dapur Utama">
                    </div>
                </div>
                <div class="form-group full-width">
                    <label for="wasteNotes">Catatan</label>
                    <textarea id="wasteNotes" placeholder="Catatan tambahan..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('wasteModal')">Batal</button>
                    <button type="submit" class="btn btn-success">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <div id="confirmModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 id="confirmTitle">Konfirmasi</h3>
                <span class="close" onclick="closeModal('confirmModal')">&times;</span>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">Apakah Anda yakin?</p>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('confirmModal')">Batal</button>
                <button type="button" id="confirmBtn" class="btn btn-danger">Ya, Hapus</button>
            </div>
        </div>
    </div>

    <div id="toast-container" class="toast-container"></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- MOCK DATABASE ---
        let ingredients = [
            { id: 1, name: 'Beras Premium', category: 'karbohidrat', stock: 50, unit: 'kg', price: 15000, minStock: 10, storage: 'kering', expiry: '2026-12-31' },
            { id: 2, name: 'Dada Ayam Fillet', category: 'protein', stock: 15.5, unit: 'kg', price: 55000, minStock: 5, storage: 'freezer', expiry: '2025-09-10' },
            { id: 3, name: 'Telur Ayam', category: 'protein', stock: 100, unit: 'pcs', price: 2000, minStock: 20, storage: 'chiller', expiry: '2025-09-25' },
            { id: 4, name: 'Bawang Merah', category: 'rempah', stock: 5, unit: 'kg', price: 35000, minStock: 1, storage: 'suhu-ruang', expiry: '2025-10-30' },
            { id: 5, name: 'Minyak Goreng', category: 'lainnya', stock: 20, unit: 'liter', price: 25000, minStock: 5, storage: 'kering', expiry: '2026-06-01' },
            { id: 6, name: 'Tomat', category: 'sayuran', stock: 3.2, unit: 'kg', price: 12000, minStock: 1, storage: 'chiller', expiry: '2025-09-08' },
        ];

        let recipes = [
            { id: 1, name: 'Nasi Goreng Spesial', category: 'makanan-utama', servings: 2, cookTime: 20, difficulty: 'mudah', price: 25000,
            image: 'https://placehold.co/300x150/4A90E2/FFFFFF?text=Nasi+Goreng',
            ingredients: [{ id: 1, amount: 0.2 }, { id: 3, amount: 2 }, { id: 4, amount: 0.05 }, { id: 5, amount: 0.03 }],
            instructions: '1. Panaskan minyak, tumis bumbu.\n2. Masukkan telur, orak-arik.\n3. Masukkan nasi dan aduk rata.\n4. Sajikan hangat.' },
            { id: 2, name: 'Ayam Bakar Madu', category: 'makanan-utama', servings: 4, cookTime: 60, difficulty: 'sedang', price: 80000,
            image: 'https://placehold.co/300x150/50E3C2/FFFFFF?text=Ayam+Bakar',
            ingredients: [{ id: 2, amount: 1 }, { id: 4, amount: 0.1 }],
            instructions: '1. Haluskan bumbu dan campur dengan madu.\n2. Ungkep ayam dengan bumbu.\n3. Bakar ayam hingga matang sambil dioles sisa bumbu.' },
        ];
        
        // Mock historical data for reports
        const today = new Date();
        const yesterday = new Date(new Date().setDate(today.getDate() - 1));
        const lastWeek = new Date(new Date().setDate(today.getDate() - 7));
        const lastMonth = new Date(new Date().setDate(today.getDate() - 30));

        let wasteData = [
            { id: 1, type: 'organik', amount: 2.5, unit: 'kg', source: 'Dapur Utama', date: yesterday },
            { id: 2, type: 'minyak', amount: 0.5, unit: 'liter', source: 'Penggorengan', date: lastWeek },
            { id: 3, type: 'kemasan', amount: 1.2, unit: 'kg', source: 'Penerimaan Barang', date: lastMonth },
        ];
        let productionHistory = [
            { id: 1, recipeName: 'Nasi Goreng Spesial', quantity: 10, chef: 'Budi', date: yesterday, status: 'Selesai' },
            { id: 2, recipeName: 'Ayam Bakar Madu', quantity: 5, chef: 'Siti', date: lastWeek, status: 'Selesai' },
            { id: 3, recipeName: 'Nasi Goreng Spesial', quantity: 15, chef: 'Budi', date: lastMonth, status: 'Selesai' },
        ];

        let processingQueue = [];
        let activities = [];

        // --- CHART INSTANCES ---
        let wasteChartInstance;

        // --- DOM ELEMENT SELECTORS ---
        const pageTitle = document.getElementById('page-title');
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.querySelector('.main-content');

        // --- CORE APP LOGIC ---

        const addActivity = (icon, text) => {
            const time = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            activities.unshift({ icon, text, time });
            if (activities.length > 5) {
                activities.pop();
            }
            renderActivities();
        };

        const renderActivities = () => {
            const list = document.getElementById('activityList');
            list.innerHTML = activities.map(act => `
                <div class="activity-item">
                    <i class="${act.icon}"></i>
                    <span>${act.text}</span>
                    <small>${act.time}</small>
                </div>
            `).join('');
            if (!activities.length) {
                list.innerHTML = '<p>Belum ada aktivitas terbaru.</p>';
            }
        };

        const switchSection = (sectionId) => {
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.getElementById(sectionId)?.classList.add('active');

            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.querySelector(`.nav-link[data-section="${sectionId}"]`)?.closest('.nav-item').classList.add('active');
            
            const newTitle = document.querySelector(`.nav-link[data-section="${sectionId}"] span`).textContent;
            pageTitle.textContent = newTitle;
            
            if (sectionId === 'waste') {
                setTimeout(() => renderWasteChart(), 50); 
            }
        };

        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionId = e.currentTarget.dataset.section;
                switchSection(sectionId);
            });
        });

        document.getElementById('sidebarToggle').addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('full-width');
        });

        // --- MODAL HANDLING ---
        window.openModal = (modalId) => document.getElementById(modalId).classList.add('active');
        window.closeModal = (modalId) => {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
            modal.querySelectorAll('form').forEach(form => form.reset());
            if (modalId === 'recipeModal') {
                const ingredientContainer = document.getElementById('recipeIngredients');
                while (ingredientContainer.children.length > 1) {
                    ingredientContainer.removeChild(ingredientContainer.lastChild);
                }
            }
        };

        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                closeModal(e.target.id);
            }
        });

        // --- DATA RENDERING FUNCTIONS ---
        const updateDashboard = () => {
            document.getElementById('totalRecipes').textContent = recipes.length;
            document.getElementById('totalIngredients').textContent = ingredients.length;
            
            const lowStock = ingredients.filter(i => i.stock <= i.minStock).length;
            document.getElementById('lowStockItems').textContent = lowStock;
            
            const today = new Date();
            const nextWeek = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 7);
            const expiring = ingredients.filter(i => i.expiry && new Date(i.expiry) <= nextWeek).length;
            document.getElementById('expiringItems').textContent = expiring;
        };

        const renderIngredients = () => {
            const grid = document.getElementById('ingredientsGrid');
            grid.innerHTML = '';
            ingredients.forEach(ing => {
                const stockStatus = ing.stock <= ing.minStock ? '<span class="status-badge status-low">Stok Rendah</span>' : '<span class="status-badge status-good">Cukup</span>';
                grid.innerHTML += `
                    <div class="ingredient-card">
                        <div class="ingredient-card-header">
                            <h4>${ing.name}</h4>
                            <small>${ing.category}</small>
                        </div>
                        <div class="ingredient-card-body">
                            <p class="ingredient-info"><strong>Stok:</strong> ${ing.stock} ${ing.unit}</p>
                            <p class="ingredient-info"><strong>Harga:</strong> Rp ${ing.price.toLocaleString('id-ID')}/${ing.unit}</p>
                            <p class="ingredient-info"><strong>Penyimpanan:</strong> ${ing.storage}</p>
                            <p class="ingredient-info"><strong>Kedaluwarsa:</strong> ${ing.expiry || 'N/A'}</p>
                            <div>${stockStatus}</div>
                        </div>
                        <div class="ingredient-card-footer">
                            <button class="btn btn-sm btn-secondary" onclick="editIngredient(${ing.id})"><i class="fas fa-edit"></i> Edit</button>
                            <button class="btn btn-sm btn-danger" onclick="confirmDelete('ingredient', ${ing.id})"><i class="fas fa-trash"></i> Hapus</button>
                        </div>
                    </div>
                `;
            });
        };
        
        const renderRecipes = () => {
            const grid = document.getElementById('recipesGrid');
            grid.innerHTML = '';
            recipes.forEach(rec => {
                grid.innerHTML += `
                    <div class="recipe-card">
                        <div class="recipe-card-image" style="background-image: url('${rec.image}')"></div>
                        <div class="recipe-card-header">
                            <h4>${rec.name}</h4>
                        </div>
                        <div class="recipe-card-body">
                            <p class="recipe-info"><strong>Kategori:</strong> ${rec.category}</p>
                            <p class="recipe-info"><strong>Porsi:</strong> ${rec.servings}</p>
                            <p class="recipe-info"><strong>Waktu:</strong> ${rec.cookTime} menit</p>
                            <p class="recipe-info"><strong>Kesulitan:</strong> ${rec.difficulty}</p>
                        </div>
                        <div class="recipe-card-footer">
                            <button class="btn btn-sm btn-success" onclick="startProcessingFromRecipe(${rec.id})"><i class="fas fa-play"></i> Masak</button>
                            <button class="btn btn-sm btn-secondary" onclick="editRecipe(${rec.id})"><i class="fas fa-edit"></i> Edit</button>
                            <button class="btn btn-sm btn-danger" onclick="confirmDelete('recipe', ${rec.id})"><i class="fas fa-trash"></i> Hapus</button>
                        </div>
                    </div>
                `;
            });
        };
        
        const renderInventory = () => {
            const tableBody = document.getElementById('inventoryTableBody');
            tableBody.innerHTML = '';
            let totalValue = 0;

            ingredients.forEach(ing => {
                const today = new Date();
                const expiryDate = new Date(ing.expiry);
                const daysUntilExpiry = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
                
                let status = '<span class="status-badge status-good">Aman</span>';
                if (ing.stock <= ing.minStock) {
                    status = `<span class="status-badge status-low">Stok Rendah</span>`;
                } else if (ing.expiry && daysUntilExpiry <= 7 && daysUntilExpiry > 0) {
                    status = `<span class="status-badge status-expiring">Akan Kedaluwarsa</span>`;
                } else if (ing.expiry && daysUntilExpiry <= 0) {
                    status = `<span class="status-badge status-danger">Kedaluwarsa</span>`;
                }
                
                const itemTotalValue = ing.stock * ing.price;
                totalValue += itemTotalValue;

                tableBody.innerHTML += `
                    <tr>
                        <td>${ing.name}</td>
                        <td>${ing.category}</td>
                        <td>${ing.stock}</td>
                        <td>${ing.unit}</td>
                        <td>Rp ${ing.price.toLocaleString('id-ID')}</td>
                        <td>Rp ${itemTotalValue.toLocaleString('id-ID')}</td>
                        <td>${ing.expiry || 'N/A'}</td>
                        <td>${status}</td>
                        <td>
                            <button class="btn btn-sm btn-secondary" onclick="editIngredient(${ing.id})"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-sm btn-danger" onclick="confirmDelete('ingredient', ${ing.id})"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });

            document.getElementById('totalInventoryValue').textContent = `Rp ${totalValue.toLocaleString('id-ID')}`;
            document.getElementById('lowStockCount').textContent = ingredients.filter(i => i.stock <= i.minStock).length;
            document.getElementById('expiringCount').textContent = ingredients.filter(i => i.expiry && new Date(i.expiry) <= new Date(new Date().setDate(new Date().getDate() + 7))).length;
        };


        // --- CRUD and other actions ---

        const ingredientForm = document.getElementById('ingredientForm');
        ingredientForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = document.getElementById('ingredientId').value;
            const newIngredient = {
                name: document.getElementById('ingredientName').value,
                category: document.getElementById('ingredientCategory').value,
                stock: parseFloat(document.getElementById('ingredientStock').value),
                unit: document.getElementById('ingredientUnit').value,
                price: parseFloat(document.getElementById('ingredientPrice').value),
                minStock: parseFloat(document.getElementById('ingredientMinStock').value),
                storage: document.getElementById('ingredientStorage').value,
                expiry: document.getElementById('ingredientExpiry').value,
            };

            if (id) { 
                const index = ingredients.findIndex(i => i.id == id);
                ingredients[index] = { ...ingredients[index], ...newIngredient };
                showToast('Bahan berhasil diperbarui!', 'success');
                addActivity('fas fa-edit text-warning', `Memperbarui bahan ${newIngredient.name}`);
            } else {
                newIngredient.id = Date.now();
                ingredients.push(newIngredient);
                showToast('Bahan baru berhasil ditambahkan!', 'success');
                 addActivity('fas fa-plus-circle text-success', `Menambahkan bahan ${newIngredient.name}`);
            }

            closeModal('ingredientModal');
            initializeAppState();
        });

        window.openIngredientModal = () => {
            document.getElementById('ingredientModalTitle').textContent = 'Tambah Bahan Baru';
            ingredientForm.reset();
            document.getElementById('ingredientId').value = '';
            openModal('ingredientModal');
        };

        window.editIngredient = (id) => {
            const ing = ingredients.find(i => i.id === id);
            if (!ing) return;
            
            document.getElementById('ingredientModalTitle').textContent = 'Edit Bahan';
            document.getElementById('ingredientId').value = ing.id;
            document.getElementById('ingredientName').value = ing.name;
            document.getElementById('ingredientCategory').value = ing.category;
            document.getElementById('ingredientStock').value = ing.stock;
            document.getElementById('ingredientUnit').value = ing.unit;
            document.getElementById('ingredientPrice').value = ing.price;
            document.getElementById('ingredientMinStock').value = ing.minStock;
            document.getElementById('ingredientStorage').value = ing.storage;
            document.getElementById('ingredientExpiry').value = ing.expiry;

            openModal('ingredientModal');
        };
        
        const recipeForm = document.getElementById('recipeForm');
        recipeForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = document.getElementById('recipeId').value;
            const recipeIngredients = [];
            document.querySelectorAll('#recipeIngredients .ingredient-row').forEach(row => {
                const ingId = row.querySelector('.ingredient-select').value;
                const ingAmount = row.querySelector('input[name="ingredientAmount[]"]').value;
                if (ingId && ingAmount) {
                    recipeIngredients.push({ id: parseInt(ingId), amount: parseFloat(ingAmount) });
                }
            });

            const newRecipe = {
                name: document.getElementById('recipeName').value,
                category: document.getElementById('recipeCategory').value,
                servings: parseInt(document.getElementById('recipeServings').value),
                cookTime: parseInt(document.getElementById('recipeCookTime').value),
                difficulty: document.getElementById('recipeDifficulty').value,
                price: parseFloat(document.getElementById('recipePrice').value),
                image: `https://placehold.co/300x150/CCCCCC/FFFFFF?text=${document.getElementById('recipeName').value.replace(' ','+')}`,
                ingredients: recipeIngredients,
                instructions: document.getElementById('recipeInstructions').value,
            };

            if (id) {
                const index = recipes.findIndex(r => r.id == id);
                recipes[index] = { ...recipes[index], ...newRecipe };
                showToast('Resep berhasil diperbarui!', 'success');
                 addActivity('fas fa-edit text-warning', `Memperbarui resep ${newRecipe.name}`);
            } else { 
                newRecipe.id = Date.now();
                recipes.push(newRecipe);
                showToast('Resep baru berhasil ditambahkan!', 'success');
                 addActivity('fas fa-plus-circle text-success', `Menambahkan resep ${newRecipe.name}`);
            }

            closeModal('recipeModal');
            initializeAppState();
        });

        window.openRecipeModal = () => {
            document.getElementById('recipeModalTitle').textContent = 'Tambah Resep Baru';
            recipeForm.reset();
            document.getElementById('recipeId').value = '';
            populateIngredientSelects();
            openModal('recipeModal');
        };

        window.editRecipe = (id) => {
            const rec = recipes.find(r => r.id === id);
            if (!rec) return;

            document.getElementById('recipeModalTitle').textContent = 'Edit Resep';
            document.getElementById('recipeId').value = rec.id;
            document.getElementById('recipeName').value = rec.name;
            document.getElementById('recipeCategory').value = rec.category;
            document.getElementById('recipeServings').value = rec.servings;
            document.getElementById('recipeCookTime').value = rec.cookTime;
            document.getElementById('recipeDifficulty').value = rec.difficulty;
            document.getElementById('recipePrice').value = rec.price;
            document.getElementById('recipeInstructions').value = rec.instructions;

            const container = document.getElementById('recipeIngredients');
            container.innerHTML = ''; // Clear existing
            rec.ingredients.forEach(ing => addIngredientRow(ing.id, ing.amount));

            openModal('recipeModal');
        };

        const populateIngredientSelects = (selectElement) => {
            const selects = selectElement ? [selectElement] : document.querySelectorAll('.ingredient-select');
            selects.forEach(select => {
                select.innerHTML = '<option value="">Pilih Bahan</option>';
                ingredients.forEach(ing => {
                    select.innerHTML += `<option value="${ing.id}">${ing.name} (${ing.unit})</option>`;
                });
            });
        };

        window.addIngredientRow = (selectedId = '', amount = '') => {
            const container = document.getElementById('recipeIngredients');
            const newRow = document.createElement('div');
            newRow.className = 'ingredient-row';
            newRow.innerHTML = `
                <select class="ingredient-select" name="ingredientId[]" required></select>
                <input type="number" name="ingredientAmount[]" placeholder="Jumlah" min="0" step="0.1" value="${amount}" required>
                <button type="button" class="btn btn-sm btn-danger" onclick="removeIngredientRow(this)">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(newRow);
            const newSelect = newRow.querySelector('.ingredient-select');
            populateIngredientSelects(newSelect);
            if (selectedId) {
                newSelect.value = selectedId;
            }
        };

        window.removeIngredientRow = (button) => {
            button.closest('.ingredient-row').remove();
        };

        window.confirmDelete = (type, id) => {
            const confirmModal = document.getElementById('confirmModal');
            const confirmMessage = document.getElementById('confirmMessage');
            const confirmBtn = document.getElementById('confirmBtn');

            let itemName = '';
            if (type === 'ingredient') {
                itemName = ingredients.find(i => i.id === id)?.name;
            } else if (type === 'recipe') {
                itemName = recipes.find(r => r.id === id)?.name;
            }

            confirmMessage.textContent = `Apakah Anda yakin ingin menghapus "${itemName}"? Tindakan ini tidak dapat diurungkan.`;
            confirmBtn.onclick = () => {
                deleteItem(type, id, itemName);
                closeModal('confirmModal');
            };
            openModal('confirmModal');
        };

        const deleteItem = (type, id, name) => {
            if (type === 'ingredient') {
                ingredients = ingredients.filter(i => i.id !== id);
            } else if (type === 'recipe') {
                recipes = recipes.filter(r => r.id !== id);
            }
            showToast('Item berhasil dihapus.', 'success');
            addActivity('fas fa-trash text-danger', `Menghapus ${type} ${name}`);
            initializeAppState();
        };


        // --- Toast Notification ---
        const showToast = (message, type = 'info') => {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        };
        
        // --- NEWLY IMPLEMENTED FEATURES ---

        // 1. Quality Control
        window.startQualityCheck = () => {
            const checklistContainer = document.getElementById('qualityChecklist');
            const alertsContainer = document.getElementById('qualityAlerts');
            const checks = [
                "Suhu freezer sesuai standar (-18°C)",
                "Suhu chiller sesuai standar (0-4°C)",
                "Area persiapan makanan bersih dan higienis",
                "Peralatan masak sudah dicuci bersih",
                "Stok bahan mentah dan matang terpisah",
                "Tidak ada bahan yang mendekati kedaluwarsa hari ini"
            ];
            checklistContainer.innerHTML = checks.map(check => `
                <label style="display: block; margin-bottom: 10px;">
                    <input type="checkbox" style="margin-right: 10px;"> ${check}
                </label>
            `).join('');

            alertsContainer.innerHTML = `
                <div class="reminder-item">
                    <i class="fas fa-edit text-warning"></i>
                    <span>Sanitasi peralatan perlu perhatian. Pastikan semua alat dicuci ulang.</span>
                </div>
            `;
            showToast('Checklist kualitas harian dimuat.', 'info');
        };

        // 2. Waste Management
        window.openWasteModal = () => {
            openModal('wasteModal');
        };

        const wasteForm = document.getElementById('wasteForm');
        wasteForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const newWaste = {
                id: Date.now(),
                type: document.getElementById('wasteType').value,
                amount: parseFloat(document.getElementById('wasteAmount').value),
                unit: document.getElementById('wasteUnit').value,
                source: document.getElementById('wasteSource').value,
                date: new Date()
            };
            wasteData.push(newWaste);
            showToast('Data limbah berhasil dicatat', 'success');
            addActivity('fas fa-recycle text-info', `Mencatat ${newWaste.amount} ${newWaste.unit} limbah ${newWaste.type}`);
            closeModal('wasteModal');
            updateWasteSummary();
            renderWasteChart();
        });

        const updateWasteSummary = () => {
             const organic = wasteData.filter(w => w.type === 'organik').reduce((sum, w) => sum + w.amount, 0);
             const oil = wasteData.filter(w => w.type === 'minyak').reduce((sum, w) => sum + w.amount, 0);
             const packaging = wasteData.filter(w => w.type === 'kemasan').reduce((sum, w) => sum + w.amount, 0);
             document.getElementById('organicWaste').textContent = `${organic.toFixed(1)} kg`;
             document.getElementById('usedOil').textContent = `${oil.toFixed(1)} liter`;
             document.getElementById('packagingWaste').textContent = `${packaging.toFixed(1)} kg`;
        };
        
        // 3. Processing
        window.openProcessingModal = () => {
            const select = document.getElementById('processRecipe');
            select.innerHTML = '<option value="">Pilih Resep</option>';
            recipes.forEach(r => {
                select.innerHTML += `<option value="${r.id}">${r.name}</option>`;
            });
            openModal('processingModal');
        };
        
        window.startProcessingFromRecipe = (recipeId) => {
            openProcessingModal();
            document.getElementById('processRecipe').value = recipeId;
        };

        const processingForm = document.getElementById('processingForm');
        processingForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const recipeId = document.getElementById('processRecipe').value;
            const quantity = parseInt(document.getElementById('processQuantity').value);
            const recipe = recipes.find(r => r.id == recipeId);
            
            let canCook = true;
            let missing = [];
            recipe.ingredients.forEach(req => {
                const stockItem = ingredients.find(i => i.id === req.id);
                if (!stockItem || stockItem.stock < req.amount * quantity) {
                    canCook = false;
                    missing.push(stockItem ? stockItem.name : 'Bahan tidak ditemukan');
                }
            });

            if(canCook) {
                recipe.ingredients.forEach(req => {
                    const stockItem = ingredients.find(i => i.id === req.id);
                    stockItem.stock -= req.amount * quantity;
                });
                
                const newProduction = {
                    id: Date.now(),
                    recipeName: recipe.name,
                    quantity: quantity,
                    chef: document.getElementById('processChef').value,
                    status: 'Selesai',
                    date: new Date()
                };
                processingQueue.push(newProduction);
                productionHistory.push(newProduction);

                showToast(`${recipe.name} ditambahkan ke antrian!`, 'success');
                addActivity('fas fa-fire-burner text-info', `Memulai pengolahan ${quantity} porsi ${recipe.name}`);
                closeModal('processingModal');
                initializeAppState();
                renderProcessingQueue();
            } else {
                showToast(`Stok tidak cukup untuk: ${missing.join(', ')}`, 'error');
            }
        });

        const renderProcessingQueue = () => {
            const list = document.getElementById('queueList');
            list.innerHTML = '';
            if (processingQueue.length === 0) {
                list.innerHTML = '<p>Tidak ada item dalam antrian.</p>';
                return;
            }
            processingQueue.forEach(item => {
                list.innerHTML += `
                    <div class="activity-item" style="cursor: pointer;" onclick="showProcessingSteps(${item.id})">
                        <i class="fas fa-utensils text-info"></i>
                        <span>${item.quantity}x ${item.recipeName} - (${item.status})</span>
                    </div>`;
            });
        };

        window.showProcessingSteps = (queueId) => {
            const queueItem = processingQueue.find(q => q.id === queueId);
            const recipe = recipes.find(r => r.name === queueItem.recipeName);
            const stepsContainer = document.getElementById('stepsContainer');
            if (recipe) {
                const steps = recipe.instructions.split('\n').map((step) => `
                    <label style="display: block; margin-bottom: 10px;">
                        <input type="checkbox" style="margin-right: 10px;"> ${step}
                    </label>
                `).join('');
                stepsContainer.innerHTML = `<h4>Langkah untuk ${recipe.name}</h4>${steps}`;
            }
        };

        // 4. Reports and Export
        window.exportInventory = () => {
            let csvContent = "data:text/csv;charset=utf-8,";
            const headers = ["ID", "Nama Bahan", "Kategori", "Stok", "Satuan", "Harga Satuan", "Stok Minimum", "Penyimpanan", "Tanggal Kedaluwarsa"];
            csvContent += headers.join(",") + "\r\n";

            ingredients.forEach(ing => {
                const row = [ing.id, `"${ing.name}"`, ing.category, ing.stock, ing.unit, ing.price, ing.minStock, ing.storage, ing.expiry || 'N/A'];
                csvContent += row.join(",") + "\r\n";
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "laporan_inventori.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showToast('Inventori berhasil diekspor!', 'success');
        };

        window.generateReport = () => {
            const period = document.getElementById('reportPeriod').value;
            const now = new Date();
            let startDate;

            if (period === 'daily') {
                startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            } else if (period === 'weekly') {
                startDate = new Date(now.setDate(now.getDate() - 7));
            } else if (period === 'monthly') {
                startDate = new Date(now.setMonth(now.getMonth() - 1));
            }

            const filteredProduction = productionHistory.filter(p => p.date >= startDate);
            const filteredWaste = wasteData.filter(w => w.date >= startDate);

            generateInventoryReport(); // Always shows current inventory
            generateProductionReport(filteredProduction);
            generateWasteReport(filteredWaste);
            showToast('Laporan berhasil dibuat!', 'success');
        };

        const generateInventoryReport = () => {
            const body = document.getElementById('inventory-report');
            let table = `<table class="report-table">
                <thead><tr><th>Bahan</th><th>Kategori</th><th>Stok Saat Ini</th><th>Nilai Stok</th></tr></thead><tbody>`;
            if (ingredients.length === 0) {
                body.innerHTML = '<p>Tidak ada data inventaris.</p>';
                return;
            }
            ingredients.forEach(ing => {
                table += `<tr>
                    <td>${ing.name}</td>
                    <td>${ing.category}</td>
                    <td>${ing.stock} ${ing.unit}</td>
                    <td>Rp ${(ing.stock * ing.price).toLocaleString('id-ID')}</td>
                </tr>`;
            });
            table += '</tbody></table>';
            body.innerHTML = table;
        };

        const generateProductionReport = (data) => {
            const body = document.getElementById('production-report');
            if (data.length === 0) {
                body.innerHTML = '<p>Tidak ada data produksi untuk periode ini.</p>';
                return;
            }
            let table = `<table class="report-table">
                <thead><tr><th>Tanggal</th><th>Resep</th><th>Porsi</th><th>Chef</th></tr></thead><tbody>`;
            data.forEach(item => {
                table += `<tr>
                    <td>${item.date.toLocaleDateString('id-ID')}</td>
                    <td>${item.recipeName}</td>
                    <td>${item.quantity}</td>
                    <td>${item.chef}</td>
                </tr>`;
            });
            table += '</tbody></table>';
            body.innerHTML = table;
        };

        const generateWasteReport = (data) => {
            const body = document.getElementById('waste-report');
            if (data.length === 0) {
                body.innerHTML = '<p>Tidak ada data limbah untuk periode ini.</p>';
                return;
            }
            let table = `<table class="report-table">
                <thead><tr><th>Tanggal</th><th>Jenis</th><th>Jumlah</th><th>Sumber</th></tr></thead><tbody>`;
            data.forEach(item => {
                table += `<tr>
                    <td>${item.date.toLocaleDateString('id-ID')}</td>
                    <td>${item.type}</td>
                    <td>${item.amount} ${item.unit}</td>
                    <td>${item.source}</td>
                </tr>`;
            });
            table += '</tbody></table>';
            body.innerHTML = table;
        };
        
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const tabId = e.target.dataset.tab;
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');

                document.querySelectorAll('.report-tab-content').forEach(content => content.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // --- Chart Rendering ---
        const renderWasteChart = () => {
            if (!document.getElementById('wasteChart')) return;
            const ctx = document.getElementById('wasteChart').getContext('2d');
            const organic = wasteData.filter(w => w.type === 'organik').reduce((sum, w) => sum + w.amount, 0);
            const oil = wasteData.filter(w => w.type === 'minyak').reduce((sum, w) => sum + w.amount, 0);
            const packaging = wasteData.filter(w => w.type === 'kemasan').reduce((sum, w) => sum + w.amount, 0);

            if(wasteChartInstance) wasteChartInstance.destroy();
            wasteChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Organik (kg)', 'Minyak (L)', 'Kemasan (kg)'],
                    datasets: [{
                        label: 'Jumlah Limbah',
                        data: [organic, oil, packaging],
                        backgroundColor: ['#50E3C2', '#F5A623', '#4A90E2'],
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });
        };
        
        // --- Initializer ---
        const initializeAppState = () => {
            updateDashboard();
            renderIngredients();
            renderRecipes();
            renderInventory();
            renderProcessingQueue();
            updateWasteSummary();
            renderActivities();
        };

        initializeAppState();
        switchSection('dashboard');
    });
    </script>
</body>
</html>

